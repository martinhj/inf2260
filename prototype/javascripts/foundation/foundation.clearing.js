(function(e,t,n,r){"use strict";Foundation.libs.clearing={name:"clearing",version:"4.3.2",settings:{templates:{viewing:'<a href="#" class="clearing-close">Ã—</a>'+'<div class="visible-img" style="display: none"><img src="//:0">'+'<p class="clearing-caption"></p><a href="#" class="clearing-main-prev"><span></span></a>'+'<a href="#" class="clearing-main-next"><span></span></a></div>'},close_selectors:".clearing-close",init:false,locked:false},init:function(t,n,r){var i=this;Foundation.inherit(this,"set_data get_data remove_data throttle data_options");if(typeof n==="object"){r=e.extend(true,this.settings,n)}if(typeof n!=="string"){e(this.scope).find("ul[data-clearing]").each(function(){var t=e(this),n=n||{},r=t.find("li"),s=i.get_data(t);if(!s&&r.length>0){n.$parent=t.parent();i.set_data(t,e.extend({},i.settings,n,i.data_options(t)));i.assemble(t.find("li"));if(!i.settings.init){i.events().swipe_events()}}});return this.settings.init}else{return this[n].call(this,r)}},events:function(){var n=this;e(this.scope).on("click.fndtn.clearing","ul[data-clearing] li",function(t,r,i){var r=r||e(this),i=i||r,s=r.next("li"),o=n.get_data(r.parent()),u=e(t.target);t.preventDefault();if(!o)n.init();if(i.hasClass("visible")&&r[0]===i[0]&&s.length>0&&n.is_open(r)){i=s;u=i.find("img")}n.open(u,r,i);n.update_paddles(i)}).on("click.fndtn.clearing",".clearing-main-next",function(e){this.nav(e,"next")}.bind(this)).on("click.fndtn.clearing",".clearing-main-prev",function(e){this.nav(e,"prev")}.bind(this)).on("click.fndtn.clearing",this.settings.close_selectors,function(e){Foundation.libs.clearing.close(e,this)}).on("keydown.fndtn.clearing",function(e){this.keydown(e)}.bind(this));e(t).on("resize.fndtn.clearing",function(){this.resize()}.bind(this));this.settings.init=true;return this},swipe_events:function(){var t=this;e(this.scope).on("touchstart.fndtn.clearing",".visible-img",function(t){if(!t.touches){t=t.originalEvent}var n={start_page_x:t.touches[0].pageX,start_page_y:t.touches[0].pageY,start_time:(new Date).getTime(),delta_x:0,is_scrolling:r};e(this).data("swipe-transition",n);t.stopPropagation()}).on("touchmove.fndtn.clearing",".visible-img",function(n){if(!n.touches){n=n.originalEvent}if(n.touches.length>1||n.scale&&n.scale!==1)return;var r=e(this).data("swipe-transition");if(typeof r==="undefined"){r={}}r.delta_x=n.touches[0].pageX-r.start_page_x;if(typeof r.is_scrolling==="undefined"){r.is_scrolling=!!(r.is_scrolling||Math.abs(r.delta_x)<Math.abs(n.touches[0].pageY-r.start_page_y))}if(!r.is_scrolling&&!r.active){n.preventDefault();var i=r.delta_x<0?"next":"prev";r.active=true;t.nav(n,i)}}).on("touchend.fndtn.clearing",".visible-img",function(t){e(this).data("swipe-transition",{});t.stopPropagation()})},assemble:function(t){var n=t.parent();n.after('<div id="foundationClearingHolder"></div>');var r=e("#foundationClearingHolder"),i=this.get_data(n),s=n.detach(),o={grid:'<div class="carousel">'+this.outerHTML(s[0])+"</div>",viewing:i.templates.viewing},u='<div class="clearing-assembled"><div>'+o.viewing+o.grid+"</div></div>";return r.after(u).remove()},open:function(e,t,n){var r=n.closest(".clearing-assembled"),i=r.find("div").first(),s=i.find(".visible-img"),o=s.find("img").not(e);if(!this.locked()){o.attr("src",this.load(e)).css("visibility","hidden");this.loaded(o,function(){o.css("visibility","visible");r.addClass("clearing-blackout");i.addClass("clearing-container");s.show();this.fix_height(n).caption(s.find(".clearing-caption"),e).center(o).shift(t,n,function(){n.siblings().removeClass("visible");n.addClass("visible")})}.bind(this))}},close:function(t,n){t.preventDefault();var r=function(e){if(/blackout/.test(e.selector)){return e}else{return e.closest(".clearing-blackout")}}(e(n)),i,s;if(n===t.target&&r){i=r.find("div").first();s=i.find(".visible-img");this.settings.prev_index=0;r.find("ul[data-clearing]").attr("style","").closest(".clearing-blackout").removeClass("clearing-blackout");i.removeClass("clearing-container");s.hide()}return false},is_open:function(e){return e.parent().prop("style").length>0},keydown:function(t){var n=e(".clearing-blackout").find("ul[data-clearing]");if(t.which===39)this.go(n,"next");if(t.which===37)this.go(n,"prev");if(t.which===27)e("a.clearing-close").trigger("click")},nav:function(t,n){var r=e(".clearing-blackout").find("ul[data-clearing]");t.preventDefault();this.go(r,n)},resize:function(){var t=e(".clearing-blackout .visible-img").find("img");if(t.length){this.center(t)}},fix_height:function(t){var n=t.parent().children(),r=this;n.each(function(){var t=e(this),n=t.find("img");if(t.height()>r.outerHeight(n)){t.addClass("fix-height")}}).closest("ul").width(n.length*100+"%");return this},update_paddles:function(e){var t=e.closest(".carousel").siblings(".visible-img");if(e.next().length>0){t.find(".clearing-main-next").removeClass("disabled")}else{t.find(".clearing-main-next").addClass("disabled")}if(e.prev().length>0){t.find(".clearing-main-prev").removeClass("disabled")}else{t.find(".clearing-main-prev").addClass("disabled")}},center:function(e){if(!this.rtl){e.css({marginLeft:-(this.outerWidth(e)/2),marginTop:-(this.outerHeight(e)/2)})}else{e.css({marginRight:-(this.outerWidth(e)/2),marginTop:-(this.outerHeight(e)/2)})}return this},load:function(e){if(e[0].nodeName==="A"){var t=e.attr("href")}else{var t=e.parent().attr("href")}this.preload(e);if(t)return t;return e.attr("src")},preload:function(e){this.img(e.closest("li").next()).img(e.closest("li").prev())},loaded:function(e,t){function n(){t()}function r(){this.one("load",n);if(/MSIE (\d+\.\d+);/.test(navigator.userAgent)){var e=this.attr("src"),t=e.match(/\?/)?"&":"?";t+="random="+(new Date).getTime();this.attr("src",e+t)}}if(!e.attr("src")){n();return}if(e[0].complete||e[0].readyState===4){n()}else{r.call(e)}},img:function(e){if(e.length){var t=new Image,n=e.find("a");if(n.length){t.src=n.attr("href")}else{t.src=e.find("img").attr("src")}}return this},caption:function(e,t){var n=t.data("caption");if(n){e.html(n).show()}else{e.text("").hide()}return this},go:function(e,t){var n=e.find(".visible"),r=n[t]();if(r.length){r.find("img").trigger("click",[n,r])}},shift:function(e,t,n){var r=t.parent(),i=this.settings.prev_index||t.index(),s=this.direction(r,e,t),o=parseInt(r.css("left"),10),u=this.outerWidth(t),a;if(t.index()!==i&&!/skip/.test(s)){if(/left/.test(s)){this.lock();r.animate({left:o+u},300,this.unlock())}else if(/right/.test(s)){this.lock();r.animate({left:o-u},300,this.unlock())}}else if(/skip/.test(s)){a=t.index()-this.settings.up_count;this.lock();if(a>0){r.animate({left:-(a*u)},300,this.unlock())}else{r.animate({left:0},300,this.unlock())}}n()},direction:function(t,n,r){var i=t.find("li"),s=this.outerWidth(i)+this.outerWidth(i)/4,o=Math.floor(this.outerWidth(e(".clearing-container"))/s)-1,u=i.index(r),a;this.settings.up_count=o;if(this.adjacent(this.settings.prev_index,u)){if(u>o&&u>this.settings.prev_index){a="right"}else if(u>o-1&&u<=this.settings.prev_index){a="left"}else{a=false}}else{a="skip"}this.settings.prev_index=u;return a},adjacent:function(e,t){for(var n=t+1;n>=t-1;n--){if(n===e)return true}return false},lock:function(){this.settings.locked=true},unlock:function(){this.settings.locked=false},locked:function(){return this.settings.locked},outerHTML:function(e){return e.outerHTML||(new XMLSerializer).serializeToString(e)},off:function(){e(this.scope).off(".fndtn.clearing");e(t).off(".fndtn.clearing");this.remove_data();this.settings.init=false},reflow:function(){this.init()}}})(Foundation.zj,this,this.document)